"use strict";const game=document.querySelector(".game"),score=document.querySelector(".game__score"),start=document.querySelector(".game__start"),gameArea=document.querySelector(".game__area"),car=document.createElement("div"),MAX_ENEMY=7,HEIGHT_ELEM=100,keys={ArrowUp:!1,ArrowDown:!1,ArrowLeft:!1,ArrowRight:!1},setting={start:!1,score:0,speed:17,traffic:2.5};function getQuantityElements(e){return gameArea.offsetHeight/e+1}const getRandomEnemy=e=>Math.floor(Math.random()*e+1);function playGame(){setting.start&&(setting.score+=setting.speed,score.textContent="Вы проехали: "+Math.floor(setting.score/100)+"м",moveRoad(),moveEnemy(),keys.ArrowLeft&&setting.x>0&&(setting.x-=setting.speed),keys.ArrowRight&&setting.x<gameArea.offsetWidth-car.offsetWidth&&(setting.x+=setting.speed),keys.ArrowUp&&setting.y>0&&(setting.y-=setting.speed),keys.ArrowDown&&setting.y<gameArea.offsetHeight-car.offsetHeight&&(setting.y+=setting.speed),car.style.left=setting.x+"px",car.style.top=setting.y+"px",requestAnimationFrame(playGame))}function startGame(){start.classList.add("game__start--hide"),game.classList.remove("game--menu"),score.classList.remove("game__score--menu"),car.style.top="auto",car.style.bottom="20px",car.style.left=gameArea.offsetWidth/2-car.offsetWidth/2;for(let e=0;e<getQuantityElements(100);e++){const t=document.createElement("div");t.classList.add("track__line"),t.style.top=100*e+"px",t.style.height="50px",t.y=100*e,gameArea.append(t)}for(let t=0;t<getQuantityElements(100*setting.traffic);t++){const a=document.createElement("div");a.classList.add("track__traffic"),a.y=-100*setting.traffic*(t+1),a.style.top=a.y+"px",a.style.left=Math.floor(Math.random()*(gameArea.offsetWidth-50))+"px",a.style.background=`\n      transparent\n      url(./img/enemy${e=7,Math.floor(Math.random()*e+1)}.png)\n      center / contain\n      no-repeat`,gameArea.append(a)}var e;setting.score=0,setting.start=!0,gameArea.append(car),setting.x=car.offsetLeft,setting.y=car.offsetTop,requestAnimationFrame(playGame)}function moveRoad(){document.querySelectorAll(".track__line").forEach((function(e){e.y+=setting.speed,e.style.top=e.y+"px",e.y>=gameArea.offsetHeight&&(e.y=-100)}))}function moveEnemy(){document.querySelectorAll(".track__traffic").forEach((function(e){let t=car.getBoundingClientRect(),a=e.getBoundingClientRect();t.top<=a.bottom&&t.right>=a.left&&t.left<=a.right&&t.bottom>=a.top&&(setting.start=!1,start.classList.remove("game__start--hide"),game.classList.add("game--menu"),score.classList.add("game__score--menu"),gameArea.innerHTML=""),e.y+=setting.speed/2,e.style.top=e.y+"px",e.y>=gameArea.offsetHeight&&(e.y=-100*setting.traffic,e.style.left=Math.floor(Math.random()*(gameArea.offsetWidth-car.offsetWidth))+"px")}))}function startRun(e){keys.hasOwnProperty(e.key)&&(e.preventDefault(),keys[e.key]=!0)}function stopRun(e){keys.hasOwnProperty(e.key)&&(e.preventDefault(),keys[e.key]=!1)}function testWebP(e){var t=new Image;t.onload=t.onerror=function(){e(2==t.height)},t.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA"}car.classList.add("track__car"),start.addEventListener("click",startGame),document.addEventListener("keydown",startRun),document.addEventListener("keyup",stopRun),testWebP((function(e){1==e?document.querySelector("body").classList.add("webp"):document.querySelector("body").classList.add("no-webp")}));